(function () {
    'use strict';

    //formを生成してファイル選択
    var onClickButton = function () {
        var html =
                '<form id="uploadForm" class="upload-form" style="display: none;">' +
                '<input id="theFile" name="the_file" type="file">' +
                '</form>';
        $('body').append(html);
        $('#theFile').on('change', uploadFile).click();
        //alert('clicked');
    };

    
    //画像アップロード用POST
    var uploadFile = function () {
        var formData = new FormData($('#uploadForm')[0]);
        var dataImg='R0lGODlhDwAPAKECAAAAzMzM/////wAAACwAAAAADwAPAAACIISPeQHsrZ5ModrLlN48CXF8m2iQ3YmmKqVlRtW4MLwWACH+H09wdGltaXplZCBieSBVbGVhZCBTbWFydFNhdmVyIQAAOw=='
        formData.append('img', dataImg);

        $.ajax({
            url: '/up2',
            type: 'post',
            data: formData,
            processData: false,
            contentType: false,
            timeout: 10000,
        }).success(function (result) {
            console.log('done');
        }).fail(function (data, textStatus, errorThrown) {
            console.log('fail');
            alert(errorThrown);
        }).then(function (result) {
            $('#uploadForm').remove();
            //pathを記載
            $("#target")[0].innerHTML=result.path;
        });

    };

    //posをwordに変換
    var onMapPos=function(e){
        //送信データ準備
        var data={'x':e.offsetX, 'y':e.offsetY};
        data=JSON.stringify(data);
        //送信
        $.ajax({
            url: '/pos2word',
            type: 'post',
            dataType: 'json',
            contentType: 'application/json',
            data:JSON.stringify(data),
            timeout: 10000,
        }).success(function (result) {
            console.log('success');
            //結果を表示
            var res=JSON.stringify(result);
            res=JSON.parse(res);
            var parent=$("#result")[0];
            parent.innerHTML=res[0];

        }).fail(function (data, textStatus, errorThrown) {
            console.log('fail');
            alert(errorThrown);
        }).then(function () {
        });
    };

    //$('#bttb').on('click', onClickButton);
    $('#map').on('mousemove', onMapPos(e));
})();

